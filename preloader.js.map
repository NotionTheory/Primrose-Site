{"version":3,"file":"preloader.js","sources":["preloader/index.js"],"sourcesContent":["function get(file, done) {\r\n  const x = new XMLHttpRequest();\r\n  x.onload = done && function(){ done(x.response); }\r\n  x.onprogress = prog && prog.thunk;\r\n  x.open(\"GET\", file);\r\n  x.send();\r\n}\r\n\r\nif(!window.PRIMROSE_TELEMETRY_OPT_OUT) {\r\n  get(\"https://www.primrosevr.com/telemetry\");\r\n}\r\n\r\nfunction findProgressBar() {\r\n  if(!prog.bar){\r\n    prog.bar = document.querySelector(\"progress\");\r\n  }\r\n}\r\n\r\nconst prog = {\r\n  bar: null,\r\n  files: {},\r\n  loaded: 0,\r\n  total: 0,\r\n\r\n  shrink: (size) => {\r\n    findProgressBar();\r\n    if(prog.bar) {\r\n      prog.bar.style.height = size;\r\n    }\r\n  },\r\n\r\n  hide: () => {\r\n    findProgressBar();\r\n    if(prog.bar) {\r\n      prog.bar.style.display = \"none\";\r\n    }\r\n  },\r\n\r\n  thunk: (evt) => {\r\n    const file = evt.target.responseURL || evt.target.currentSrc;\r\n    if(file){\r\n      if(!prog.files[file]){\r\n        prog.files[file] = {};\r\n      }\r\n      const f = prog.files[file];\r\n      if(typeof evt.loaded === \"number\") {\r\n        f.loaded = evt.loaded;\r\n        f.total = evt.total;\r\n      }\r\n      else if(evt.srcElement) {\r\n        const bs = evt.srcElement.buffered;\r\n        let min = Number.MAX_VALUE,\r\n          max = Number.MIN_VALUE;\r\n        for(let i = 0; i < bs.length; ++i){\r\n          min = Math.min(min, bs.start(i));\r\n          max = Math.max(max, bs.end(i));\r\n        }\r\n        f.loaded = 1000 * max;\r\n        f.total = 1000 * evt.srcElement.duration;\r\n      }\r\n    }\r\n\r\n    let total = 0, loaded = 0;\r\n    for(var key in prog.files){\r\n      const f = prog.files[key];\r\n      loaded += f.loaded;\r\n      total += f.total;\r\n    }\r\n\r\n    prog.loaded = loaded;\r\n    prog.total = total;\r\n\r\n    findProgressBar();\r\n\r\n    if(prog.bar && total){\r\n      prog.bar.max = total;\r\n      prog.bar.value = loaded;\r\n    }\r\n  }\r\n},\r\n\r\n  curScripts = document.querySelectorAll(\"script\"),\r\n  curScript = curScripts[curScripts.length - 1],\r\n  scripts = [];\r\n\r\nfunction installScripts() {\r\n  if(!document.body){\r\n    setTimeout(installScripts, 0);\r\n  }\r\n  else if(window.DEBUG) {\r\n    if(scripts.length > 0) {\r\n      const file = scripts.shift(),\r\n        s = document.createElement(\"script\");\r\n      s.src = file;\r\n      s.onload = installScripts;\r\n      document.body.appendChild(s);\r\n    }\r\n  }\r\n  else{\r\n    const s = document.createElement(\"script\");\r\n    s.innerHTML = scripts.join(\"\\n\");\r\n    document.body.appendChild(s);\r\n  }\r\n}\r\n\r\nlet loaded = 0;\r\nfunction getNextScript(file, i, arr) {\r\n  get(file, (contents) => {\r\n    if(window.DEBUG) {\r\n      scripts[i] = file;\r\n    }\r\n    else{\r\n      scripts[i] = contents;\r\n    }\r\n    ++loaded;\r\n    if(loaded === arr.length) {\r\n      installScripts();\r\n    }\r\n  });\r\n}\r\n\r\n\r\nif(curScript && curScript.dataset.files) {\r\n  curScript.dataset.files.split(\",\").forEach(getNextScript);\r\n}\r\n\r\nexport default prog;\r\n"],"names":["get","file","done","x","XMLHttpRequest","onload","response","onprogress","prog","thunk","open","send","window","PRIMROSE_TELEMETRY_OPT_OUT","findProgressBar","bar","document","querySelector","size","style","height","display","evt","target","responseURL","currentSrc","files","f","loaded","total","srcElement","bs","buffered","min","Number","MAX_VALUE","max","MIN_VALUE","i","length","Math","start","end","duration","key","value","curScripts","querySelectorAll","curScript","scripts","installScripts","body","DEBUG","shift","s","createElement","src","appendChild","innerHTML","join","getNextScript","arr","contents","dataset","split","forEach"],"mappings":"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"}